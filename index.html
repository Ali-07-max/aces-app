<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ACEs Assessment Tool</title>
  <style>
    :root { 
      --gap: 16px; 
      --border: #000; 
      --primary: #000;
      --bg: #fff;
    }
    
    * { box-sizing: border-box; }
    
    body { 
      font-family: 'Courier New', Courier, monospace; /* Monospaced for a technical/clean feel */
      margin: 0;
      padding: 20px; 
      color: var(--primary);
      background: var(--bg);
      line-height: 1.6;
    }
    
    h1 { 
      margin: 0 0 10px 0; 
      font-size: 28px; 
      font-weight: 900;
      text-transform: uppercase;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
    }
    
    .sub { 
      margin: 0 0 30px 0; 
      font-size: 14px; 
    }
    
    .wrap { 
      max-width: 900px; 
      margin: 0 auto;
      background: white;
      border: 2px solid var(--primary);
      padding: 40px;
    }
    
    .card {
      border: 1px solid var(--primary);
      padding: 20px;
      margin: 20px 0;
      background: #fff;
    }
    
    .qhead { 
      display: flex; 
      align-items: flex-start; 
      justify-content: space-between; 
      gap: var(--gap); 
      margin-bottom: 15px;
    }
    
    .qtext { 
      font-size: 16px; 
      font-weight: 500;
    }
    
    .qnum { 
      font-weight: 900; 
      margin-right: 8px; 
    }
    
    .rightbox { 
      min-width: 120px; 
      text-align: right; 
      font-weight: bold;
    }
    
    .totalbadge {
      display: inline-block;
      padding: 4px 8px;
      border: 1px solid var(--primary);
      font-weight: 700;
      font-size: 14px;
      background: #fff;
    }
    
    .row { 
      display: grid; 
      grid-template-columns: 100px 1fr 40px; 
      gap: var(--gap); 
      align-items: center; 
      margin-top: 10px; 
    }
    
    .label { 
      font-size: 14px; 
      font-weight: 600;
      text-transform: uppercase;
    }
    
    /* Custom Range Slider Styling for B&W */
    input[type="range"] { 
      width: 100%;
      height: 4px;
      background: #000;
      outline: none;
      -webkit-appearance: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #fff;
      border: 2px solid #000;
      cursor: pointer;
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #fff;
      border: 2px solid #000;
      cursor: pointer;
    }
    
    input[type="range"]:disabled {
      opacity: 0.2;
      cursor: not-allowed;
    }
    
    .value { 
      font-variant-numeric: tabular-nums; 
      text-align: right; 
      font-weight: 900;
    }
    
    .toggle {
      border-top: 1px solid #ddd;
      padding-top: 12px;
      margin-top: 12px;
      display: flex;
      align-items: center;
      font-weight: bold;
    }
    
    .toggle label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
    }
    
    .toggle input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      border: 2px solid #000;
      appearance: none;
      -webkit-appearance: none;
      display: grid;
      place-content: center;
    }

    .toggle input[type="checkbox"]::before {
      content: "";
      width: 10px;
      height: 10px;
      transform: scale(0);
      transition: 120ms transform ease-in-out;
      box-shadow: inset 1em 1em black;
    }

    .toggle input[type="checkbox"]:checked::before {
      transform: scale(1);
    }
    
    .summary {
      border: 4px solid var(--primary);
      padding: 30px;
      margin-top: 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--gap);
      background: #fff;
    }
    
    .sumright { 
      font-size: 48px; 
      font-weight: 900; 
      font-variant-numeric: tabular-nums;
    }
    
    .btnrow { 
      margin-top: 30px; 
      display: flex; 
      gap: 16px; 
      flex-wrap: wrap; 
      justify-content: flex-end;
    }
    
    button {
      padding: 12px 24px; 
      border: 2px solid var(--primary);
      background: white;
      color: black;
      cursor: pointer;
      font-size: 16px;
      font-weight: 700;
      font-family: inherit;
      text-transform: uppercase;
      transition: all 0.1s;
    }
    
    button:hover { 
      background: #000;
      color: white;
    }
    
    button:active {
      transform: translateY(2px);
    }
    
    #exportOut {
      white-space: pre-wrap; 
      margin-top: 20px; 
      display: none; 
      border: 2px solid var(--primary); 
      padding: 20px; 
      background: #f0f0f0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      max-height: 500px;
      overflow-y: auto;
    }
    
    @media print {
      body { padding: 0; }
      .wrap { border: none; padding: 0; }
      .btnrow, #exportOut { display: none !important; }
      .card { page-break-inside: avoid; border: 1px solid #999; }
    }
    
    @media (max-width: 600px) {
      .wrap { padding: 15px; border: none; }
      .qhead { flex-direction: column; }
      .rightbox { text-align: left; margin-top: 5px; }
      .row { grid-template-columns: 1fr; }
      .value { text-align: left; margin-bottom: 10px; }
      .summary { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>ACEs Assessment Tool</h1>
  <p class="sub">
    <strong>Adverse Childhood Experiences (ACEs) Questionnaire</strong><br>
    Instructions: For each experience, check "Yes" if it applies to you. Then, rate the Frequency and Severity on a scale of 1-10.
  </p>
  
  <div id="questions"></div>
  
  <div class="summary">
    <div class="sumleft">
      <div style="font-size: 20px; font-weight: bold;">TOTAL SCORE</div>
      <div>Sum of all item totals (Frequency + Severity)</div>
    </div>
    <div class="sumright" id="overallTotal">0</div>
  </div>
  
  <div class="btnrow">
    <button type="button" id="resetBtn">Reset</button>
    <button type="button" id="printBtn">Print</button>
    <button type="button" id="exportBtn">Export JSON</button>
    <button type="button" id="saveBtn">Save to Disk</button>
  </div>
  
  <pre id="exportOut"></pre>
</div>

<script>
  // ========================================
  // ACEs QUESTIONS DATA
  // ========================================
  const ACE_QUESTIONS = [
    {
      id: 1,
      text: "Did a parent or other adult in the household often or very often... Swear at you, insult you, put you down, or humiliate you? or Act in a way that made you afraid that you might be physically hurt?"
    },
    {
      id: 2,
      text: "Did a parent or other adult in the household often or very often... Push, grab, slap, or throw something at you? or Ever hit you so hard that you had marks or were injured?"
    },
    {
      id: 3,
      text: "Did an adult or person at least five years older than you ever... Touch or fondle you or have you touch their body in a sexual way? or Attempt or actually have oral, anal, or vaginal intercourse with you?"
    },
    {
      id: 4,
      text: "Did you often or very often feel that... No one in your family loved you or thought you were important or special? or Your family didn't look out for each other, feel close to each other, or support each other?"
    },
    {
      id: 5,
      text: "Did you often or very often feel that... You didn't have enough to eat, had to wear dirty clothes, and had no one to protect you? or Your parents were too drunk or high to take care of you or take you to the doctor if you needed it?"
    },
    {
      id: 6,
      text: "Were your parents ever separated or divorced? If so rate the degree of tension, expressed anger, altercations, fear you experienced as both a witness or personally."
    },
    {
      id: 7,
      text: "Was your mother or stepmother: Often or very often pushed, grabbed, slapped, or had something thrown at her? or Sometimes, often, or very often kicked, bitten, hit with a fist, or hit with something hard? or Ever repeatedly hit at least a few minutes or threatened with a gun or knife?"
    },
    {
      id: 8,
      text: "Did you live with anyone who was a problem drinker or alcoholic or who used street drugs?"
    },
    {
      id: 9,
      text: "Was a household member depressed or mentally ill, or did a household member attempt suicide?"
    },
    {
      id: 10,
      text: "Did a household member go to prison or be deployed for more than a few days?"
    }
  ];

  // ========================================
  // LOGIC & UI
  // ========================================
  const container = document.getElementById("questions");

  function escapeHtml(s) {
    return String(s).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  }
  
  function computeItemTotal(freq, sev) {
    return freq + sev;
  }

  function makeQuestionCard(q) {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="qhead">
        <div class="qtext"><span class="qnum">${q.id}.</span>${escapeHtml(q.text)}</div>
        <div class="rightbox">
          <div class="totalbadge">Total: <span id="itemTotal_${q.id}">0</span></div>
        </div>
      </div>
      <div class="toggle">
        <label>
          <input type="checkbox" id="yes_${q.id}">
          <span>YES (Enable Sliders)</span>
        </label>
      </div>
      <div class="row">
        <div class="label">Frequency</div>
        <input type="range" min="1" max="10" value="1" step="1" id="freq_${q.id}" disabled>
        <div class="value"><span id="freqVal_${q.id}">1</span></div>
      </div>
      <div class="row">
        <div class="label">Severity</div>
        <input type="range" min="1" max="10" value="1" step="1" id="sev_${q.id}" disabled>
        <div class="value"><span id="sevVal_${q.id}">1</span></div>
      </div>
    `;
    return card;
  }

  ACE_QUESTIONS.forEach(q => container.appendChild(makeQuestionCard(q)));

  function updateItem(qid) {
    const yes = document.getElementById(`yes_${qid}`).checked;
    const freqEl = document.getElementById(`freq_${qid}`);
    const sevEl = document.getElementById(`sev_${qid}`);
    
    freqEl.disabled = !yes;
    sevEl.disabled = !yes;
    
    const freq = Number(freqEl.value);
    const sev = Number(sevEl.value);
    
    document.getElementById(`freqVal_${qid}`).textContent = freq;
    document.getElementById(`sevVal_${qid}`).textContent = sev;
    
    const total = yes ? computeItemTotal(freq, sev) : 0;
    document.getElementById(`itemTotal_${qid}`).textContent = total;
    
    updateOverall();
  }

  function updateOverall() {
    let sum = 0;
    ACE_QUESTIONS.forEach(q => {
      const yes = document.getElementById(`yes_${q.id}`).checked;
      if(yes) {
        const freq = Number(document.getElementById(`freq_${q.id}`).value);
        const sev = Number(document.getElementById(`sev_${q.id}`).value);
        sum += computeItemTotal(freq, sev);
      }
    });
    document.getElementById("overallTotal").textContent = sum;
  }

  // Listeners
  ACE_QUESTIONS.forEach(q => {
    const qid = q.id;
    [`yes_${qid}`, `freq_${qid}`, `sev_${qid}`].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', () => updateItem(qid));
      el.addEventListener('change', () => updateItem(qid));
    });
  });

  // Buttons
  document.getElementById("resetBtn").addEventListener("click", () => {
    if(!confirm("Start over?")) return;
    ACE_QUESTIONS.forEach(q => {
      document.getElementById(`yes_${q.id}`).checked = false;
      document.getElementById(`freq_${q.id}`).value = 1;
      document.getElementById(`sev_${q.id}`).value = 1;
      updateItem(q.id);
    });
    document.getElementById("exportOut").style.display = "none";
  });

  document.getElementById("printBtn").addEventListener("click", () => window.print());

  function getPayload() {
    return {
      tool: "ACEs Assessment",
      date: new Date().toISOString(),
      items: ACE_QUESTIONS.map(q => {
        const yes = document.getElementById(`yes_${q.id}`).checked;
        const freq = Number(document.getElementById(`freq_${q.id}`).value);
        const sev = Number(document.getElementById(`sev_${q.id}`).value);
        return {
          id: q.id,
          question: q.text,
          yes,
          frequency: yes ? freq : 0,
          severity: yes ? sev : 0,
          score: yes ? computeItemTotal(freq, sev) : 0
        };
      }),
      totalScore: Number(document.getElementById("overallTotal").textContent)
    };
  }

  document.getElementById("exportBtn").addEventListener("click", () => {
    const p = getPayload();
    const out = document.getElementById("exportOut");
    out.textContent = JSON.stringify(p, null, 2);
    out.style.display = "block";
    out.scrollIntoView({behavior: "smooth"});
  });

  document.getElementById("saveBtn").addEventListener("click", () => {
    const p = getPayload();
    const blob = new Blob([JSON.stringify(p, null, 2)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `ACEs-Result-${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });

</script>
</body>
</html>
